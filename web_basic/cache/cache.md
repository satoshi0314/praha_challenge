# cache

[課題](hhttps://airtable.com/tblg8ePOEQRDtIGiY/viwV3pAlEvPOOgmHF/recLu5JYLtVoU3uk0?blocks=hide)

## 課題 1

- なぜキャッシュが必要か
  ウェブキャッシュは遅延やネットワークのトラフィックを削減して、リソースを表示するために必要な時間も短縮するため、アプリケーションの高速化に不可欠なため。

- キャッシュの種類
  - ブラウザキャッシュ
    1人のユーザーのためのキャッシュで、ユーザーがHTTPでダウンロードしたすべてのドキュメントを保持します。このキャッシュは訪問済みのドキュメントで、サーバーとのやりとりを追加で行うことなく戻る/進む操作、ページの保存、ソースの表示をできるようにします。またキャッシュ済みのコンテンツをオフラインで表示できるようにもします。
  - プロキシキャッシュ
    複数のユーザーによって再使用されるレスポンスを保存するキャッシュで、人気があるリソースを何度も再使用してネットワークのトラフィックや遅延を低減させることができます

- ブラウザがキャッシュを制御するために存在するヘッダー
  - Cache-Control
    - リクエストおよびレスポンスでキャッシュ機能に関するディレクティブを指定するために使用します。
      - 具体的には、リソースの有効期限や再検証を設定する
  - Pragma
    - HTTP/1.0 クライアントとの後方互換用のもので、`Cache-Control: no-cache` と同じ働きをする。
    - Cache-Control ヘッダーがある場合は無視される
  - Expires
    - レスポンスが古くなると見なされる日時が入ります
    - その値から Date ヘッダーの値を減算した結果を鮮度の寿命にします
    - レスポンスに max-age または s-maxage ディレクティブを持つ Cache-Control ヘッダーがある場合、Expires ヘッダーは無視されます。
  - ETag
    - ETag ヘッダーがリソースのレスポンスの一部に含まれていたら、クライアントは以降のリクエストでキャッシュ済みリソースの確認を行うために If-None-Match をヘッダーに含めることができます。
  - Last-Modified
    - Cache-Control, Expiresのどちらも与えられていないときに、Date ヘッダーの値から Last-modified ヘッダーの値を減算して 10 で割った結果をキャッシュの寿命にします
  - Vary
    - 提供元のサーバーからレスポンスを得るように要求せずにキャッシュ済みのレスポンスを使用できるかを判断するために、以降のリクエストヘッダーをどのように照合するかを定義します。
    - Vary ヘッダーフィールドを持つキャッシュ済みレスポンスに合致可能なリクエストをキャッシュが受け取ったとき、Vary ヘッダーで指定されたすべてのヘッダーフィールドが元の (キャッシュ済み) リクエストと新たなリクエストの両方で一致しなければ、キャッシュ済みレスポンスを使用してはいけません

- ブラウザのキャッシュサイズの上限は、ユーザが自由に変更できます
  - キャッシュサイズの容量上限を超えると何が起きるでしょうか？容量上限はどの程度でしょうか？
    - ヒント：ブラウザにより挙動が異なります
    - 「上限に達したら何が起きるのか」「上限容量の感覚値」「ブラウザごとに差分があること」を認識してもらうのが目的のため、ブラウザのソースコードなどを読み解いて正確な値を調べていただく必要はございません！

- あなたは、マイページ（ユーザの情報が動的に表示されるページ）の作成を任されました。マイページへのアクセスが多いことに気づいたあなたは、マイページをキャッシュしておくことを考えました。そこで「expires」ヘッダをレスポンスに含めることで、1週間程度はキャッシュを使用するように設定しました
  - すると先輩エンジニアに「動的なサイトをキャッシュするなら、expiresは使わない方が良いよ」と言われました。なぜでしょうか？どうすれば良いのでしょうか？

- ブラウザのキャッシュがWEBサービスに用いられている実例を、3つ以上見つけて共有してください。どのような仕組みで対象がキャッシュされているのか、技術的な流れを説明してみてください
  - chromeの開発者コンソールの「ネットワーク」タブを使って探すのがオススメです
  - こんなスクリーンショットを撮ってみてください
    - https://drive.google.com/file/d/1OmrwTdmkMCA9cmbfWNyQKWJiJCsTQWuF/view

## 課題２（実装）

### 仕様

- 何かしらの画像を返す、簡単なWEBサーバを作成してください
- WEBサーバには2つのエンドポイントを用意してください
- 1つ目のエンドポイントでは、同じクライアントによるアクセスの場合ブラウザのキャッシュを使うことで、アクセス負荷を減らしましょう
- 2つ目のエンドポイントではブラウザキャッシュを使わず画像を返すようにしてください


## 課題３（成果物に関する質問）

- ブラウザキャッシュを使うべきではない状況を考えて、ペアと会話してみてください
  - どんなサービスの？
  - どんなページで？
  - どんなファイルを？
  - キャッシュしない方が良いでしょうか？

## 課題４（クイズ）

ブラウザキャッシュに関するクイズを作成してください
クイズに関する詳細は　コチラ　を参照してください
